<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<title>Cholloscrapping</title>
	<style type="text/css">
			body {
	  margin: 0 auto;
	  max-width: 56em;
	  padding: 1em 0;
	}

	.grid {
	  /* Grid Fallback */
	  display: flex;
	  flex-wrap: wrap;
	  
	  /* Supports Grid */
	  display: grid;
	  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
	  grid-auto-rows: minmax(150px, auto);
	  grid-gap: 1em;
	}

	.module {
	  /* Demo-Specific Styles */
	  background: #eaeaea;
	  align-items: center;
	  justify-content: center;
	  height: 200px;
	  
	  /* Flex Fallback */
	  margin-left: 5px;
	  margin-right: 5px;
	  flex: 1 1 200px;
	}

	/* If Grid is supported, remove the margin we set for the fallback */
	@supports (display: grid) {
	  .module {
	    margin: 0;
	  }
	}
	</style>
</head>
<body>
	<h1>Welcome to Cholloscrapping</h1>
	<i>List of products from <a target="_blank" href="https://www.pccomponentes.com">PcComponentes.</a></i>
	<br><br>

<form id="searchWhoosh" action="{% url 'searchWhoosh' %}">
	{% csrf_token %}
	<input type="text" id="search" name="q">
	<input type="number" id="query-limit" name="limit" min="1" value="10">
	<button type="submit" id="searchsubmit">Search</button>
</form>

<div id="productsWhoosh">
</div>

<div class="grid">  
{% for product in products %}
	<div class="module">
	<a href="details/{{product.sku}}">
		<img style="margin-left: 30px;" width="150px" src="{{product.image}}"></a>
		<br>
		<p style="text-align: center;">{{ product.name }}</p>
		
	</div>
{% endfor %}
</div>

	<script>

	$('#searchsubmit').on('click', function(e){
		e.preventDefault();

		q = $('#search').val();
		ql = $('#query-limit').val();

		$.ajax({
			url: '/products/searchWhoosh/',
			data: {
				'query': q,
				'query_limit': ql
			},
			dataType: 'json',
			success: function (data) {
				console.log(data);
				$("#productsWhoosh").html("");
				data.forEach((product)=>{
					let p = document.createElement('p');
					p.innerText = product;
					document.querySelector('#productsWhoosh').appendChild(p);
				})
			}
		}); 
  });

	</script>

</body>
</html>