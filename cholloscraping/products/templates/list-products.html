<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

	<title>Cholloscrapping</title>
	<style type="text/css">
			body {
	  margin: 0 auto;
	  max-width: 56em;
	  padding: 1em 0;
	}

	.grid {
	  /* Grid Fallback */
	  display: flex;
	  flex-wrap: wrap;
	  
	  /* Supports Grid */
	  display: grid;
	  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
	  grid-auto-rows: minmax(150px, auto);
	  grid-gap: 1em;
	}

	.module {
	  /* Demo-Specific Styles */
	  background: #eaeaea;
	  align-items: center;
	  justify-content: center;
	  height: 200px;
	  
	  /* Flex Fallback */
	  margin-left: 5px;
	  margin-right: 5px;
	  flex: 1 1 200px;
	}

	/* If Grid is supported, remove the margin we set for the fallback */
	@supports (display: grid) {
	  .module {
	    margin: 0;
	  }
	}
	</style>
</head>
<body>

	<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark ">
		<a class="navbar-brand" href="{% url 'index' %}">Inicio</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
			<div class="navbar-nav">
				<a class="nav-item nav-link" href="{% url 'listProducts' %}">Productos <span class="sr-only">(current)</span></a>
				<a class="nav-item nav-link" href="{% url 'indexWhoosh' %}">Recargar Whoosh</a>
			</div>
		</div>
	</nav>

	<h1 class="text-center">Listado de todos los productos</h1>
	<p class="text-center">
		<i>Estos productos son de <a target="_blank" href="https://www.pccomponentes.com">PcComponentes.</a></i>
	</p>

<form id="searchWhoosh" action="{% url 'searchWhoosh' %}">
	{% csrf_token %}
	<div class="row">
		<div class="col">
			<label for="search">Buscar</label>
			<input type="text" class="form-control form-control-sm" id="search" placeholder="Buscar en Cholloscrapping" name="q"><br>
		</div>
		<div class="col">
			<label for="query-limit">Número de artículos</label>
			<input type="number" class="form-control form-control-sm" id="query-limit" name="limit" min="1" value="10"><br>
		</div>
	</div>
	<p class="text-center">
		<button type="submit" class="btn btn-primary" id="searchsubmit">Buscar</button>
	</p>
</form>

<div id="productsWhoosh">
</div>

<h3 class="text-center">Lista de todos los productos</h3>


{% include "products-grid.html" %}  

	<script>

	$('#searchsubmit').on('click', function(e){
		e.preventDefault();

		q = $('#search').val();
		ql = $('#query-limit').val();

		$.ajax({
			url: '/products/searchWhoosh/',
			data: {
				'query': q,
				'query_limit': ql
			},
			dataType: 'json',
			success: function (data) {
				console.log(data);
				$("#productsWhoosh").html("");
				data.forEach((product)=>{
					let productDiv = document.createElement("div");
					let productImage = document.createElement("img");
					productImage.src = product[1];
					productImage.style.width = "150px";

					var viewButton = document.createElement("input");
					viewButton.type = "button";
					viewButton.value = "View";
					viewButton.onclick = function(){
						location.href = "../details/"+product[0];
					}

					let productInfo = document.createElement('p');
					productInfo.style = "display:inline; margin-left:15px; margin-right:30px;";
					productInfo.innerText = product[2]+" - "+product[3]+" - "+product[4]+" - "+product[5]+"€";

					document.querySelector('#productsWhoosh').appendChild(productDiv);
					productDiv.appendChild(productImage);
					productDiv.appendChild(productInfo);
					productDiv.appendChild(viewButton);
				})
			},
			error: function (){
				console.log("Can't retrieve products from DB");
			}
		}); 
  });

	</script>


</body>
</html>