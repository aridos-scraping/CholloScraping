<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

	<title>Cholloscrapping</title>
	
</head>
<body>

{% include "index.html" %} 

<form id="searchWhoosh" action="{% url 'searchWhoosh' %}">
	{% csrf_token %}
	<div class="row">
		<div class="col">
			<label for="search">Buscar</label>
			<input type="text" class="form-control form-control-sm" id="search" placeholder="Buscar en Cholloscrapping" name="q"><br>
		</div>
		<div class="col">
			<label for="query-limit">Número de artículos</label>
			<input type="number" class="form-control form-control-sm" id="query-limit" name="limit" min="1" value="10"><br>
		</div>
	</div>
	<p class="text-center">
		<button type="submit" class="btn btn-primary" id="searchsubmit">Buscar</button>
	</p>
</form>

<div id="productsWhoosh">
</div>

<h3 class="text-center">Lista de todos los productos</h3>


{% include "products-grid.html" %}  

	<script>

	$('#searchsubmit').on('click', function(e){
		e.preventDefault();

		q = $('#search').val();
		ql = $('#query-limit').val();

		$.ajax({
			url: '/products/searchWhoosh/',
			data: {
				'query': q,
				'query_limit': ql
			},
			dataType: 'json',
			success: function (data) {
				console.log(data);
				$("#productsWhoosh").html("");
				data.forEach((product)=>{
					let productDiv = document.createElement("div");
					let productImage = document.createElement("img");
					productImage.src = product[1];
					productImage.style.width = "150px";

					var viewButton = document.createElement("input");
					viewButton.type = "button";
					viewButton.value = "View";
					viewButton.onclick = function(){
						location.href = "/products/details/"+product[0];
					}

					let productInfo = document.createElement('p');
					productInfo.style = "display:inline; margin-left:15px; margin-right:30px;";
					productInfo.innerText = product[2]+" - "+product[3]+" - "+product[4]+" - "+product[5]+"€";

					document.querySelector('#productsWhoosh').appendChild(productDiv);
					productDiv.appendChild(productImage);
					productDiv.appendChild(productInfo);
					productDiv.appendChild(viewButton);
				})
			},
			error: function (){
				console.log("Can't retrieve products from DB");
			}
		}); 
  });

	</script>


</body>
</html>